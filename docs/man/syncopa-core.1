.TH SYNCOPA-CORE 1 "May 2024" "Syncopa Core" "User Commands"
.SH NAME
syncopa-core \- plan and execute high performance filesystem synchronisation
.SH SYNOPSIS
.B syncopa-core
.BR scan 
.RI [ options ]
.br
.B syncopa-core
.BR sync 
.RI [ options ]
.br
.B syncopa-core help
.SH DESCRIPTION
The
.B syncopa-core
utility exposes the core Syncopa scanning and synchronisation engines.
It provides two primary subcommands:
.TP
.B scan
Compare a source and destination tree, printing the operations required to
reconcile them without making any changes.
.TP
.B sync
Execute the reconciliation tasks generated by the scanner and optionally export
run reports.
.PP
Both commands share several flags for controlling batching, verbosity, and
synchronisation modes.
.SH OPTIONS
.PP
The most common global options are:
.TP
.BR --mode =update|mirror|sync
Choose how source and destination are reconciled. See the MODES section.
.TP
.BR --batch-threshold =BYTES
Enable batching for files whose size is less than or equal to the given number of
bytes. Setting this to zero disables batching.
.TP
.BR --batch-max-files =N
Cap the number of files that may be grouped into a single batch archive.
.TP
.BR --batch-max-bytes =BYTES
Cap the total size of a batch archive.
.TP
.B --verbose
Print additional context for each task.
.SH MODES
.TP
.B update
Copy new or modified files from source to destination. Extra destination files
are not touched.
.TP
.B mirror
Copy new or modified files and delete files that exist only at the destination.
.TP
.B sync
Keep both locations aligned by copying newer files in either direction.
.SH COMMANDS
.SS scan
.TP
.BR --src =PATH
Source directory to analyse.
.TP
.BR --dst =PATH
Destination directory to analyse.
.PP
The scan command writes planned operations to standard output in the order they
should be executed. It never changes the filesystem.
.SS sync
.TP
.BR --src =PATH
Source directory to synchronise.
.TP
.BR --dst =PATH
Destination directory to synchronise.
.TP
.BR --workers =N
Number of concurrent workers used for copy and delete tasks (default: 4).
.TP
.BR --bandwidth =BYTES_PER_SEC
Throttle copy throughput. A value of zero disables throttling.
.TP
.BR --report-pdf =FILE
Write a PDF summary report when the binary is built with reporting support.
.TP
.BR --report-csv =FILE
Write a detailed CSV report when the binary is built with reporting support.
.PP
The sync command first performs a scan, then feeds the resulting tasks to a
worker pool. It prints a summary upon completion when summaries are enabled.
.SH EXIT STATUS
.TP
.B 0
Command completed successfully.
.TP
.B 1
An error occurred (invalid flags, filesystem failures, or unexpected internal
errors).
.SH FILES
.TP
.I $HOME/.config/syncopa-core/
Suggested location for configuration files when embedding the CLI.
.SH EXAMPLES
Plan a mirror migration while enabling batching for small files:
.PP
.nf
syncopa-core scan --src ~/source --dst /mnt/archive --mode mirror \
  --batch-threshold $((256 * 1024)) --batch-max-bytes $((4 * 1024 * 1024))
.fi
.PP
Mirror directories with eight workers and a 100 MiB/s throttle while exporting a
CSV report:
.PP
.nf
syncopa-core sync --src /data/raw --dst /data/processed --mode mirror \
  --workers 8 --bandwidth $((100 * 1024 * 1024)) --report-csv reports/run.csv
.fi
.SH SEE ALSO
.BR syncopa-core (7),
.BR rsync (1)
